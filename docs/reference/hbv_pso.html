<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>HBV Modelling with Particle Swarm Optimization — hbv_pso • hbvPSO</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">hbvPSO</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/hbvPSO.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/test.html">HTML-Class Demo</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jthurner/hbvPSO">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>HBV Modelling with Particle Swarm Optimization</h1>
    </div>

    
    <p>Performs particle swarm optimization of the HBV hydrological model by wrapping <a href='http://www.rdocumentation.org/packages/hydroPSO/topics/hydroPSO'>hydroPSO</a> and <a href='http://www.rdocumentation.org/packages/TUWmodel/topics/TUWmodel'>TUWmodel</a>.</p>
    

    <pre class="usage"><span class='fu'>hbv_pso</span>(<span class='kw'>prec</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>airt</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>ep</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>area</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>param</span> <span class='kw'>=</span> <span class='kw pkg'>hbvPSO</span><span class='kw ns'>::</span><span class='no'><a href='http://www.rdocumentation.org/packages/hbvPSO/topics/tuwmodel_params_default'>tuwmodel_params_default</a></span>, <span class='kw'>obs</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>from</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>to</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>warmup</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>telev</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>pelev</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>elev_zones</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>incon</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>outpath</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>hydroPSO_args</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>FUN_gof</span> <span class='kw'>=</span> <span class='kw pkg'>hydroGOF</span><span class='kw ns'>::</span><span class='no'><a href='http://www.rdocumentation.org/packages/hydroGOF/topics/NSE'>NSE</a></span>, <span class='kw'>FUN_gof_args</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>plotting</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>prec</th>
      <td><p>Precipitation input (mm/day) as zoo, matrix or numerical. If multivariate, each variable is the input for one zone.</p></td>
    </tr>
    <tr>
      <th>airt</th>
      <td><p>Air Temperature input (degC/day) as zoo, matrix or numerical. If multivariate, each variable is the input for one zone.</p></td>
    </tr>
    <tr>
      <th>ep</th>
      <td><p>Potential Evapotranspiration (mm/day) as zoo, matrix or numerical. If multivariate, each variable is the input for one zone.</p></td>
    </tr>
    <tr>
      <th>area</th>
      <td><p>If input data is distributed into zones (multivariate zoo/matrix), a vector of the decimal proportion of area for each zone.</p></td>
    </tr>
    <tr>
      <th>param</th>
      <td><p>Parameters as two-column (min,max) matrix or dataframe if optimization should be performed, and as vector otherwise.</p><ol>
<li><p><code>SCF</code> snow correction factor (0.9-1.5);</p></li>
<li><p><code>DDF</code> degree day factor (0.0-5.0 mm/degC/timestep);</p></li>
<li><p><code>Tr</code> threshold temperature above which precipitation is rain (1.0-3.0 degC);</p></li>
<li><p><code>Ts</code> threshold temperature below which precipitation is snow (-3.0-1.0 degC);</p></li>
<li><p><code>Tm</code> threshold temperature above which melt starts (-2.0-2.0 degC);</p></li>
<li><p><code>LPrat</code> parameter related to the limit for potential evaporation (0.0-1.0);</p></li>
<li><p><code>FC</code> field capacity, i.e., max soil moisture storage (0-600 mm);</p></li>
<li><p><code>BETA</code> the non linear parameter for runoff production (0.0-20.0);</p></li>
<li><p><code>k0</code> storage coefficient for very fast response (0.0-2.0 timestep);</p></li>
<li><p><code>k1</code> storage coefficient for fast response (2.0-30.0 timestep);</p></li>
<li><p><code>k2</code> storage coefficient for slow response (30.0-250.0 timestep);</p></li>
<li><p><code>lsuz</code> threshold storage state, i.e., the very fast response start if exceeded (1.0-100.0 mm);</p></li>
<li><p><code>cperc</code> constant percolation rate (0.0-8.0 mm/timestep);</p></li>
<li><p><code>bmax</code> maximum base at low flows (0.0-30.0 timestep);</p></li>
<li><p><code>croute</code> free scaling parameter (0.0-50.0 timestep2/mm);</p></li>
<li><p><code>tcalt</code> Lapse rate to adjust the temperature data by elevation zone (ºC/100m, decreasing with elevation)</p></li>
<li><p><code>pcalt</code> Lapse rate to adjust the precipitation data by elevation zone (<!-- %/100m, increasing with elevation) --></p></li>
</ol><p>The last two parameters are optional and used to transform the temperature/precipitation input (instead of being passed on to TUWmodel). To disable pcalt/tcalt, set them to zero or ommit from param.
See <a href='tuwmodel_params_default.html'>tuwmodel_params_default</a> for an example with the default ranges as specified in <a href='http://www.rdocumentation.org/packages/TUWmodel/topics/TUWmodel'>TUWmodel</a>.</p></td>
    </tr>
    <tr>
      <th>obs</th>
      <td><p>Observed Discharge (mm/day) as zoo or numerical</p></td>
    </tr>
    <tr>
      <th>from</th>
      <td><p>Start of the modelling period (including warmup) as Date or string in standard date format. Requires input datasets to be zoo objects.</p></td>
    </tr>
    <tr>
      <th>to</th>
      <td><p>End of the modelling period as Date or string in standard date format. Requires input datasets to be zoo objects.</p></td>
    </tr>
    <tr>
      <th>warmup</th>
      <td><p>Warmup phase which is removed before calculating goodness of fit. Can be given as numeric (days removed from the model start date) or date (as Date object or string in default format which can be cast to Date by as.Date). If given as date, it marks the start of the simulation period after warmup.</p></td>
    </tr>
    <tr>
      <th>telev</th>
      <td><p>Reference Elevation for the air temperature input, used to adjust temperature by tcalt.</p></td>
    </tr>
    <tr>
      <th>pelev</th>
      <td><p>Reference Elevation for the precipitation input, used to adjust precipitation by pcalt.</p></td>
    </tr>
    <tr>
      <th>elev_zones</th>
      <td><p>Vector of mean elevation for each zone. Only required if tcalt/pcalt is used.</p></td>
    </tr>
    <tr>
      <th>incon</th>
      <td><p>vector/matrix of initial conditions for the model (<code>ncol</code> = number of zones):
<code>SSM0</code> soil moisture (mm);
<code>SWE0</code> snow water equivalent (mm);
<code>SUZ0</code> initial value for fast (upper zone) response storage (mm);
<code>SLZ0</code> initial value for slow (lower zone) response storage (mm)</p></td>
    </tr>
    <tr>
      <th>outpath</th>
      <td><p>Path to the directory storing the output files as string. If not NULL, the following is set in in hydroPSO's control list: <code>drty.out=outpath</code> and <code>write2disk=TRUE</code></p></td>
    </tr>
    <tr>
      <th>hydroPSO_args</th>
      <td><p>Arguments passed on to <a href='http://www.rdocumentation.org/packages/hydroPSO/topics/hydroPSO'>hydroPSO</a></p></td>
    </tr>
    <tr>
      <th>FUN_gof</th>
      <td><p>The function used to calculate goodness of fit. Must take sim and obs as first arguments.</p></td>
    </tr>
    <tr>
      <th>FUN_gof_args</th>
      <td><p>Further arguments passed on to <code>FUN_gof</code></p></td>
    </tr>
    <tr>
      <th>plotting</th>
      <td><p>Toggles plotting of the results (with <a href='http://www.rdocumentation.org/packages/hydroPSO/topics/ReadPlot_results'>plot_results</a> if optimization is performed, otherwise with <a href='http://www.rdocumentation.org/packages/hydroPSO/topics/ReadPlot_out'>plot_out</a>). As alternative to <code>TRUE</code>, a list of arguments for the respective plotting functions can be provided.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list of the following items:</p><ol>
<li><p><code>sim</code> simulated runoff (mm/day) of the best model run</p></li>
<li><p><code>obs</code> observed runoff (mm/day)</p></li>
<li><p><code>gof</code> goodness of fit of the best model run</p></li>
<li><p><code>pso_out</code> <a href='http://www.rdocumentation.org/packages/hydroPSO/topics/hydroPSO'>hydroPSO</a> output</p></li>
<li><p><code>hbv_out</code> <a href='http://www.rdocumentation.org/packages/TUWmodel/topics/TUWmodel'>TUWmodel</a> output from the best model run</p></li>
</ol>

    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='co'># loading the example data from TUWmodel</span>
<span class='fu'>data</span>(<span class='no'>example_TUWmodel</span>, <span class='kw'>package</span><span class='kw'>=</span><span class='st'>"TUWmodel"</span>)
<span class='co'># extracting the input data for the lumped case (see TUWmodel examples):</span>
<span class='co'># 1.) apply weighted means</span>
<span class='no'>prec</span> <span class='kw'>&lt;-</span> <span class='fu'>apply</span>(<span class='no'>P_Vils</span>, <span class='fl'>1</span>, <span class='no'>weighted.mean</span>, <span class='kw'>w</span><span class='kw'>=</span><span class='no'>areas_Vils</span>)
<span class='no'>airt</span> <span class='kw'>&lt;-</span> <span class='fu'>apply</span>(<span class='no'>T_Vils</span>, <span class='fl'>1</span>, <span class='no'>weighted.mean</span>, <span class='kw'>w</span><span class='kw'>=</span><span class='no'>areas_Vils</span>)
<span class='no'>ep</span> <span class='kw'>&lt;-</span> <span class='fu'>apply</span>(<span class='no'>PET_Vils</span>, <span class='fl'>1</span>, <span class='no'>weighted.mean</span>, <span class='kw'>w</span><span class='kw'>=</span><span class='no'>areas_Vils</span>)
<span class='co'># 2.) casting from named numeric vector to zoo</span>
<span class='no'>prec</span> <span class='kw'>&lt;-</span> <span class='fu'>zoo</span>(<span class='no'>prec</span>, <span class='kw'>order.by</span><span class='kw'>=</span><span class='fu'>as.Date</span>(<span class='fu'>names</span>(<span class='no'>prec</span>)))
<span class='no'>airt</span> <span class='kw'>&lt;-</span> <span class='fu'>zoo</span>(<span class='no'>airt</span>, <span class='kw'>order.by</span><span class='kw'>=</span><span class='fu'>as.Date</span>(<span class='fu'>names</span>(<span class='no'>airt</span>)))
<span class='no'>ep</span> <span class='kw'>&lt;-</span> <span class='fu'>zoo</span>(<span class='no'>ep</span>, <span class='kw'>order.by</span><span class='kw'>=</span><span class='fu'>as.Date</span>(<span class='fu'>names</span>(<span class='no'>ep</span>)))
<span class='no'>obs</span> <span class='kw'>&lt;-</span> <span class='fu'>zoo</span>(<span class='no'>Q_Vils</span>, <span class='kw'>order.by</span><span class='kw'>=</span><span class='fu'>as.Date</span>(<span class='fu'>names</span>(<span class='no'>Q_Vils</span>)))
<span class='co'># setting up date range and warmup, limit max iterations to 500</span>
<span class='no'>control</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(<span class='kw'>maxit</span><span class='kw'>=</span><span class='fl'>500</span>)
<span class='no'>from</span> <span class='kw'>&lt;-</span> <span class='st'>"1976-01-01"</span>
<span class='no'>to</span> <span class='kw'>&lt;-</span> <span class='st'>"1996-12-31"</span>
<span class='no'>warmup</span> <span class='kw'>&lt;-</span> <span class='st'>"1977-01-01"</span>
<span class='co'># running hbv_PSO with default options, without plotting or parallel processing</span>
<span class='no'>res</span> <span class='kw'>&lt;-</span> <span class='fu'>hbv_pso</span>(<span class='kw'>prec</span><span class='kw'>=</span><span class='no'>prec</span>, <span class='kw'>airt</span><span class='kw'>=</span><span class='no'>airt</span>, <span class='kw'>ep</span><span class='kw'>=</span><span class='no'>ep</span>, <span class='kw'>obs</span><span class='kw'>=</span><span class='no'>obs</span>,<span class='kw'>hydroPSO_args</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>control</span><span class='kw'>=</span><span class='no'>control</span>))
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Joschka Thurner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
